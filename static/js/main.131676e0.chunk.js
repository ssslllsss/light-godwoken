(this["webpackJsonpwithdraw-demo"]=this["webpackJsonpwithdraw-demo"]||[]).push([[0],{415:function(e,t,n){},436:function(e,t){},439:function(e,t){},441:function(e,t){},453:function(e,t){},454:function(e,t){},473:function(e,t){},475:function(e,t){},490:function(e,t){},494:function(e,t){},498:function(e,t){},500:function(e,t){},545:function(e,t){},551:function(e,t){},558:function(e,t){},586:function(e,t){},588:function(e,t){},595:function(e,t){},596:function(e,t){},614:function(e,t){},829:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(32),r=n.n(i),c=(n(415),n(416),n(127)),o=n(19),l=n(181),d=n.n(l),h=n(16),p=n(120),u=n(63),b=n.n(u),g=n(180);const f={code_hash:"0x79f90bb5e892d80dd213439eeab551120eb417678824f282b4ffb5f21bad2e1e",hash_type:"type",tx_hash:"0x9154df4f7336402114d04495175b37390ce86a4906d2d4001cf02c3e6d97f39c",index:"0x0",dep_type:"code"},x={script_type_hash:"0x170ef156e9f6132dbca6069dfd3e436f7d91c29d3ac7332c4b33e633b6a299b5",cell_dep:{out_point:{tx_hash:"0xb4b07dcd1571ac18683b515ada40e13b99bd0622197b6817047adc9f407f4828",index:"0x0"},dep_type:"code"}},w={script_type_hash:"0xdeec13a7b8e100579541384ccaf4b5223733e4a5483c3aec95ddc4c1d5ea5b22",cell_dep:{out_point:{tx_hash:"0x2f9f8ec8a1556238aeeefed29e990d53ea75060ef04249371fd8b5246fffb8ea",index:"0x0"},dep_type:"code"}},y={code_hash:"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",hash_type:"type",tx_hash:"0xf8de3bb47d055cdf460d93a2a6e1b05f7432f9777c8c474abf4eec1d4aee5d37",index:"0x0",dep_type:"dep_group",short_id:0},m={code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",tx_hash:"0xe12877ebd2c3c364dc46c5c992bcfaf4fee33fa13eebdf82c591fc9825aab769",index:"0x0",dep_type:"code"},j="0x4cc2e6526204ae6a2e8fcf12f7ad472f41a1606d5b9624beebd215d780809f6a",_={code_hash:"0x5c365147bb6c40e817a2a53e0dec3661f7390cc77f0c02db138303177b12e9fb",hash_type:"type",args:"0x213743d13048e9f36728c547ab736023a7426e15a3d7d1c82f43ec3b5f266df2"},v=[{symbol:"USDC",name:"USD Coin",decimals:18,tokenURI:"https://cryptologos.cc/logos/usd-coin-usdc-logo.svg?v=002",sudt_script_hash:"",address:"0xca6FcAAA5129aD9e5219397527A17c26E5AD6a6a",issuerLockHash:"0x58bef38794236b315b7c23fd8132d7f42676228d659b291936e8c6c7ba9f064e",l1Lock:{code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",args:"0x58bef38794236b315b7c23fd8132d7f42676228d659b291936e8c6c7ba9f064e"}},{symbol:"ETH",name:"Ethereum",decimals:18,tokenURI:"https://cryptologos.cc/logos/ethereum-eth-logo.svg?v=002",sudt_script_hash:"",address:"0xB1235Dd5bd72d9Ef2F0E311fC5ce7df0583B6458",issuerLockHash:"0x1b072aa0ded384067106ea0c43c85bd71bafa5afdb432123511da46b390a4e33",l1Lock:{code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",args:"0x1b072aa0ded384067106ea0c43c85bd71bafa5afdb432123511da46b390a4e33"}},{symbol:"TAI",name:"NexisDAO TAI",decimals:18,tokenURI:"data:image/png;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAQDAwQDAwQEAwQFBAQFBgoHBgYGBg0JCggKDw0QEA8NDw4RExgUERIXEg4PFRwVFxkZGxsbEBQdHx0aHxgaGxr/2wBDAQQFBQYFBgwHBwwaEQ8RGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhr/wAARCAAoACgDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAgEBQYBCf/EADQQAAEDAwEEBwUJAAAAAAAAAAIAAQQDBRIGBxETURUhIjJCUmIWgYKisggUFyczNEFTZ//EABkBAAMBAQEAAAAAAAAAAAAAAAMFBgIEB//EACQRAAEEAgEDBQEAAAAAAAAAAAMAAQIEERIFEyHCFCIxMoKS/9oADAMBAAIRAxEAPwB85kwIdPI/c3NZyVc68ot+TgHJmVHtFmhV0xqApFSbTj04FdiKA2+QI8Msipevy+pKXC1zGgEIWXbHe7Mfhj6js9Qh+IxHFcsti7aSUtctkKTSH1Ti5Fv35OpsW5Vo795zDk6V32y2hjZBuhbRtAdBvW4PS2RfqY5YY445Y9rHJZGbrmNNMgvG2O93gvFH09ZzEfhPHH5ks9ObbaJP52l4oIpyD7op8YcsJdNiB+v+W5IWE2cy6Q6a08cc5px6lvoMJT/3BNgOL1fX5vUhbrXR2IPv8x7KpCRyQy6muzsT71An2O2XQSa5W+JMEv76An9SvLjGePJPyH1soqS2iyCSUVNtX6ctZJBgCgWzKJGKmBRvxSKjwsezjwy7KeqBYbZaxFrbbokPHu8CgIfSkJpVvy3hv/rZN8hL0HQebsSjGP68UyCHVdHvDihS7bQevIHyB1uhJqXHWLgurB8MmjCwr6ZDCVTcT9z8ln5FurR37ubc2QhW/KVBGC5JN3ZYmOMnylqD7L9YbBQs3T4vSpaz9pOL927WPDIeFj5t/iTLx7dWkP3cG5uhCj6zPylhh2HyzIg4sr6NFCIGFP3vzQhC9JEKAIMMbYZkRf/Z",sudt_script_hash:"",address:"0x8290f27935A2D353adc834c9F3c5F6ef19635C2D",issuerLockHash:"0x13d640a864c7e84d60afd8ca9c6689d345a18f63e2e426c9623a2811776cf211",l1Lock:{code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",args:"0x13d640a864c7e84d60afd8ca9c6689d345a18f63e2e426c9623a2811776cf211"}}];var A=n(64);function k(e){return function(t,n){if(!(n instanceof ArrayBuffer)){let a=BigInt(n).toString(16);if(a.length%2!==0&&(a="0"+a),a.length/2>e)throw new Error("".concat(t," is ").concat(a.length/2," bytes long, expected length is ").concat(e,"!"));const s=new DataView(new ArrayBuffer(e));for(let e=0;e<a.length/2;e++){const t=a.length-2*(e+1);s.setUint8(e,parseInt(a.substr(t,2),16))}n=s.buffer}if(n.byteLength<e){const t=new Uint8Array(e);t.set(new Uint8Array(n),0),n=t.buffer}return n}}function O(e){return function(t,n){if(n=new A.Reader(n).toArrayBuffer(),e>0&&n.byteLength!==e)throw new Error("".concat(t," has invalid length ").concat(n.byteLength,", required: ").concat(e));return n}}function z(e,t,n){const a={};for(const[s,i]of Object.entries(n)){const n=t[s];if(void 0===n||null===n)throw new Error("".concat(e," is missing ").concat(s,"!"));a[s]=i("".concat(e,".").concat(s),n)}return a}function B(e){return function(t,n){return e(n,{debugPath:t})}}function C(e){let{debugPath:t="fee"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{sudt_id:k(4),amount:k(16)})}function S(e){let{debugPath:t="raw_withdrawal_request"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{nonce:k(4),capacity:k(8),amount:k(16),sudt_script_hash:O(32),account_script_hash:O(32),sell_amount:k(16),sell_capacity:k(8),owner_lock_hash:O(32),payment_lock_hash:O(32),fee:B(C)})}const U={CKB_INDEXER_URL:"https://testnet.ckb.dev/indexer",CKB_RPC_URL:"https://testnet.ckb.dev",GW_POLYJUICE_RPC_URL:"https://godwoken-testnet-web3-rpc.ckbapp.dev"},I={CKB_INDEXER_URL:"https://testnet.ckb.dev/indexer",CKB_RPC_URL:"https://testnet.ckb.dev",GW_POLYJUICE_RPC_URL:"https://godwoken-testnet-web3-rpc.ckbapp.dev"};var R=n(377);function E(e,t){throw new Error("Invalid data length! Required: ".concat(t,", actual: ").concat(e))}function N(e,t){e!==t&&E(e,t)}function L(e){if(e instanceof Object&&e.toArrayBuffer instanceof Function&&(e=e.toArrayBuffer()),!(e instanceof ArrayBuffer))throw new Error("Provided value must be an ArrayBuffer or can be transformed into ArrayBuffer!");return e}function T(e){const t=e.length;let n=4*(t+1);const a=[];for(let c=0;c<t;c++)a.push(n),n+=e[c].byteLength;const s=new ArrayBuffer(n),i=new Uint8Array(s),r=new DataView(s);r.setUint32(0,n,!0);for(let c=0;c<t;c++)r.setUint32(4+4*c,a[c],!0),i.set(new Uint8Array(e[c]),a[c]);return s}function M(e){const t=new Uint8Array(0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()+V.size()+V.size()+P.size());new DataView(t.buffer);return t.set(new Uint8Array(F(e.nonce)),0),t.set(new Uint8Array(Q(e.capacity)),0+q.size()),t.set(new Uint8Array(K(e.amount)),0+q.size()+H.size()),t.set(new Uint8Array(Y(e.sudt_script_hash)),0+q.size()+H.size()+J.size()),t.set(new Uint8Array(Y(e.account_script_hash)),0+q.size()+H.size()+J.size()+V.size()),t.set(new Uint8Array(K(e.sell_amount)),0+q.size()+H.size()+J.size()+V.size()+V.size()),t.set(new Uint8Array(Q(e.sell_capacity)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()),t.set(new Uint8Array(Y(e.owner_lock_hash)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()),t.set(new Uint8Array(Y(e.payment_lock_hash)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()+V.size()),t.set(new Uint8Array(G(e.fee)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()+V.size()+V.size()),t.buffer}function D(e){const t=[];return t.push(M(e.raw)),t.push(X(e.signature)),T(t)}function W(e){return T([])}class P{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}getSudtId(){return new q(this.view.buffer.slice(0,0+q.size()),{validate:!1})}getAmount(){return new J(this.view.buffer.slice(0+q.size(),0+q.size()+J.size()),{validate:!1})}validate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];N(this.view.byteLength,P.size()),this.getSudtId().validate(e),this.getAmount().validate(e)}static size(){return 0+q.size()+J.size()}}function G(e){const t=new Uint8Array(0+q.size()+J.size());new DataView(t.buffer);return t.set(new Uint8Array(F(e.sudt_id)),0),t.set(new Uint8Array(K(e.amount)),0+q.size()),t.buffer}class q{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){N(this.view.byteLength,4)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}toBigEndianUint32(){return this.view.getUint32(0,!1)}toLittleEndianUint32(){return this.view.getUint32(0,!0)}static size(){return 4}}function F(e){const t=L(e);return N(t.byteLength,4),t}class H{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){N(this.view.byteLength,8)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}toBigEndianBigUint64(){return this.view.getBigUint64(0,!1)}toLittleEndianBigUint64(){return this.view.getBigUint64(0,!0)}static size(){return 8}}function Q(e){const t=L(e);return N(t.byteLength,8),t}class J{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){N(this.view.byteLength,16)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}static size(){return 16}}function K(e){const t=L(e);return N(t.byteLength,16),t}class V{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){N(this.view.byteLength,32)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}static size(){return 32}}function Y(e){const t=L(e);return N(t.byteLength,32),t}function X(e){const t=L(e),n=new Uint8Array(4+t.byteLength);return new DataView(n.buffer).setUint32(0,t.byteLength,!0),n.set(new Uint8Array(t),4),n.buffer}class Z{constructor(e){this.rpc=void 0,this.rpc=new A.RPC(e)}async rpcCall(e){const t="gw_"+e;for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return await this.rpc[t](...a)}async submitWithdrawalRequest(e){const t=new A.Reader(D(function(e){let{debugPath:t="withdrawal_request"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{raw:B(S),signature:O(65)})}(e))).serializeJson();return await this.rpcCall("submit_withdrawal_request",t)}async getAccountIdByScriptHash(e){return await this.rpcCall("get_account_id_by_script_hash",e)}async getScriptHashByShortAddress(e){return await this.rpcCall("get_script_hash_by_short_address",e)}async getWithdrawal(e){return await this.rpcCall("get_withdrawal",e)}async getNonce(e){return await this.rpcCall("get_nonce",e)}async getScriptHash(e){return await this.rpcCall("get_script_hash",e)}}var $=n(380),ee=n.n($);function te(e,t){throw new Error("Invalid data length! Required: ".concat(t,", actual: ").concat(e))}function ne(e,t){e!==t&&te(e,t)}function ae(e){if(e instanceof Object&&e.toArrayBuffer instanceof Function&&(e=e.toArrayBuffer()),!(e instanceof ArrayBuffer))throw new Error("Provided value must be an ArrayBuffer or can be transformed into ArrayBuffer!");return e}function se(e){const t=e.length;let n=4*(t+1);const a=[];for(let c=0;c<t;c++)a.push(n),n+=e[c].byteLength;const s=new ArrayBuffer(n),i=new Uint8Array(s),r=new DataView(s);r.setUint32(0,n,!0);for(let c=0;c<t;c++)r.setUint32(4+4*c,a[c],!0),i.set(new Uint8Array(e[c]),a[c]);return s}function ie(e){const t=[];return t.push(function(e){const t=ae(e);return ne(t.byteLength,21),t}(e.identity)),t.push(function(e){return se(e.map((e=>function(e){const t=[],n=new DataView(new ArrayBuffer(1));return n.setUint8(0,e.mask),t.push(n.buffer),t.push(ce(e.proof)),se(t)}(e))))}(e.proofs)),se(t)}function re(e){const t=[];return t.push(le(e.signature)),t.push(function(e){return e?ie(e):new ArrayBuffer(0)}(e.rc_identity)),t.push(le(e.preimage)),se(t)}function ce(e){const t=ae(e),n=new Uint8Array(4+t.byteLength);return new DataView(n.buffer).setUint32(0,t.byteLength,!0),n.set(new Uint8Array(t),4),n.buffer}function oe(e){const t=ae(e),n=new Uint8Array(4+t.byteLength);return new DataView(n.buffer).setUint32(0,t.byteLength,!0),n.set(new Uint8Array(t),4),n.buffer}function le(e){return e?oe(e):new ArrayBuffer(0)}const de={web3Url:U.GW_POLYJUICE_RPC_URL,abiItems:[{inputs:[{internalType:"string",name:"name_",type:"string"},{internalType:"string",name:"symbol_",type:"string"},{internalType:"uint256",name:"totalSupply_",type:"uint256"},{internalType:"uint256",name:"sudtId_",type:"uint256"},{internalType:"uint8",name:"decimals_",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"sudtId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]},he=new R.PolyjuiceHttpProvider(de.web3Url,de);class pe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AGGRON";if(this.l2Address="",this.l1Address="",this.ckbIndexer=void 0,this.rpc=void 0,this.ethereum=void 0,this.web3=void 0,this.godwokenClient=void 0,"AGGRON"===n)h.config.initializeConfig(h.config.predefined.AGGRON4),this.ckbIndexer=new h.Indexer(I.CKB_INDEXER_URL,I.CKB_RPC_URL),this.rpc=new h.RPC(I.CKB_RPC_URL),this.godwokenClient=new Z(U.GW_POLYJUICE_RPC_URL);else{if("LINA"!==n)throw new Error("env not defined, please use AGGRON or LINA.");h.config.initializeConfig(h.config.predefined.LINA),this.ckbIndexer=new h.Indexer(U.CKB_INDEXER_URL,U.CKB_RPC_URL),this.rpc=new h.RPC(U.CKB_RPC_URL),this.godwokenClient=new Z(U.GW_POLYJUICE_RPC_URL)}this.ethereum=t,this.l2Address=e,this.l1Address=this.generateL1Address(this.l2Address),t.on("accountsChanged",(e=>{console.log("eth accounts changed",e),this.l2Address=e[0],this.l1Address=this.generateL1Address(this.l2Address)})),this.web3=new ee.a(he)}async sendWithdrawTransaction(e){return await this.godwokenClient.submitWithdrawalRequest(e)}getL2Address(){return this.l2Address}getL1Address(){return this.l1Address}static async CreateProvider(e){if(!e||!e.isMetaMask)throw new Error("please provide metamask ethereum object");return e.request({method:"eth_requestAccounts"}).then((t=>(console.log("eth_requestAccounts",t),new pe(t[0],e)))).catch((e=>{4001===e.code?console.log("Please connect to MetaMask."):console.error(e)}))}generateL1Address(e){const t={code_hash:f.code_hash,hash_type:f.hash_type,args:"0x01".concat(e.substring(2),"00")};return h.helpers.generateAddress(t)}async sendL1Transaction(e){return await this.rpc.send_transaction(e,"passthrough")}async signL1Transaction(e){const t=this.generateMessage(e);let n=await this.ethereum.request({method:"personal_sign",params:[this.ethereum.selectedAddress,t]}),a=Number.parseInt(n.slice(-2),16);a>=27&&(a-=27),n="0x"+n.slice(2,-2)+a.toString(16).padStart(2,"0");const s=new h.toolkit.Reader(h.core.SerializeWitnessArgs({lock:re({signature:new h.toolkit.Reader(n)})})).serializeJson();e=e.update("witnesses",(e=>e.push("".concat(s))));return h.helpers.createTransactionFromSkeleton(e)}generateMessage(e){const t=new h.utils.CKBHasher,n=h.utils.ckbHash(h.core.SerializeRawTransaction(h.toolkit.normalizers.NormalizeRawTransaction(h.helpers.createTransactionFromSkeleton(e)))),a=h.core.SerializeWitnessArgs({lock:new h.toolkit.Reader("0x"+"00".repeat(re({signature:new h.toolkit.Reader("0x"+"00".repeat(65))}).byteLength))});return t.update(n),this.hashWitness(t,a),t.digestHex()}hashWitness(e,t){const n=new ArrayBuffer(8);new DataView(n).setBigUint64(0,BigInt(new h.toolkit.Reader(t).length()),!0),e.update(n),e.update(t)}async getRollupCell(){const e={type:{code_hash:_.code_hash,hash_type:_.hash_type,args:_.args}},t=this.ckbIndexer.collector(e);let n;for await(const a of t.collect()){if(null===a)return;n=a;break}return n}async getLastFinalizedBlockNumber(){const e=await this.getRollupCell();if(void 0===!e)return 0;const t=new p.core.GlobalState(new h.toolkit.Reader(e.data)),n=Number(t.getLastFinalizedBlockNumber().toLittleEndianBigUint64());return console.log("last finalized block number: ",n),n}}class ue{constructor(e){this.provider=void 0,this.provider=e}getBlockProduceTime(){return 45e3}async unlock(e){const t=this.provider.l1Address,n=h.helpers.parseAddress(t),a=[];if(e.cell.cell_output.type){const t={cell_output:{capacity:"0x0",lock:n,type:e.cell.cell_output.type},data:e.cell.data},s=h.helpers.minimalCellCapacity(t),i=BigInt(e.cell.cell_output.capacity)-s;a.push({cell_output:{capacity:"0x".concat(i.toString(16)),lock:n},data:"0x"}),a.push({cell_output:{capacity:"0x".concat(s.toString(16)),lock:n,type:e.cell.cell_output.type},data:e.cell.data})}else a.push({cell_output:{capacity:e.cell.cell_output.capacity,lock:n,type:e.cell.cell_output.type},data:e.cell.data});const s={lock:"0x00000000"+new h.toolkit.Reader(W(h.toolkit.normalizers.NormalizeWitnessArgs({}))).serializeJson().slice(2)},i=new h.toolkit.Reader(h.core.SerializeWitnessArgs(h.toolkit.normalizers.NormalizeWitnessArgs(s))).serializeJson();let r=h.helpers.TransactionSkeleton({cellProvider:this.provider.ckbIndexer});const c={out_point:{tx_hash:f.tx_hash,index:f.index},dep_type:f.dep_type},o={out_point:{tx_hash:y.tx_hash,index:y.index},dep_type:y.dep_type},l={out_point:{tx_hash:x.cell_dep.out_point.tx_hash,index:x.cell_dep.out_point.index},dep_type:x.cell_dep.dep_type},d=await this.provider.getRollupCell();if(!d||!d.cell_output)throw new Error("rollup cell outpoint not found");const p={out_point:{tx_hash:d.out_point.tx_hash,index:d.out_point.index},dep_type:"code"};if(r=r.update("inputs",(t=>t.push(e.cell))).update("outputs",(e=>e.push(...a))).update("cellDeps",(e=>e.push(l))).update("cellDeps",(e=>e.push(p))).update("cellDeps",(e=>e.push(c))).update("cellDeps",(e=>e.push(o))).update("witnesses",(e=>e.push(i))),e.cell.cell_output.type){const e={out_point:{tx_hash:m.tx_hash,index:m.index},dep_type:m.dep_type};r=r.update("cellDeps",(t=>t.push(e)))}r=await this.injectCapacity(r,n,BigInt(0));const u=await this.provider.signL1Transaction(r);return await this.provider.sendL1Transaction(u)}async listWithdraw(){const e=this.getWithdrawalCellSearchParams(this.provider.l2Address);console.log("searchParams is:",e);const t=[],n=this.provider.ckbIndexer.collector({lock:e.script}),a=await this.provider.getLastFinalizedBlockNumber(),s=h.helpers.parseAddress(this.provider.l1Address),i={code_hash:s.code_hash,args:s.args,hash_type:s.hash_type},r=h.utils.computeScriptHash(i);for await(const o of n.collect()){const e=o.cell_output.lock.args,n=new p.core.WithdrawalLockArgs(new h.toolkit.Reader("0x".concat(e.slice(66))));if(null==n)continue;const s=Number(n.getWithdrawalBlockNumber().toLittleEndianBigUint64()),i=o.cell_output.lock.args.includes(r.substring(2));let c,l="0x"+"00".repeat(32),d="0x0";if(o.cell_output.type){const e={code_hash:o.cell_output.type.code_hash,args:o.cell_output.type.args,hash_type:o.cell_output.type.hash_type};l=h.utils.computeScriptHash(e);c=this.getBuiltinErc20List().find((e=>e.sudt_script_hash===l)),d="0x".concat(h.utils.readBigUInt128LE(o.data).toString(16))}i&&t.push({cell:o,withdrawalBlockNumber:s,remainingBlockNumber:Math.max(0,s-a),capacity:o.cell_output.capacity,amount:d,sudt_script_hash:l,erc20:c})}const c=t.sort(((e,t)=>e.withdrawalBlockNumber-t.withdrawalBlockNumber));return console.log("found withdraw cells:",c),c}getWithdrawalCellSearchParams(e){if(42!==e.length||!e.startsWith("0x"))throw new Error("eth address format error!");const t={code_hash:w.script_type_hash,hash_type:"type",args:j+e.slice(2).toLowerCase()},n=h.utils.computeScriptHash(t);return{script:{code_hash:x.script_type_hash,hash_type:"type",args:"".concat(j).concat(n.slice(2))},script_type:"lock"}}withdrawWithEvent(e){const t=new b.a;return this.withdraw(t,e),t}async withdraw(e,t){e.emit("sending");const n=j,a=w.script_type_hash;console.log(" helpers.parseAddress(payload.withdrawal_address || this.provider.l1Address)",t,this.provider);const s=h.helpers.parseAddress(t.withdrawal_address||this.provider.l1Address),i=h.utils.computeScriptHash(s),r={code_hash:a,hash_type:"type",args:n+this.provider.l2Address.slice(2)},c=h.utils.computeScriptHash(r);console.log("account script hash:",c);const o=await this.provider.godwokenClient.getAccountIdByScriptHash(c);if(!o)throw new Error("account not found");const l="0x0000000000000000000000000000000000000000000000000000000000000000"!==t.sudt_script_hash,d=this.minimalWithdrawalCapacity(l);if(BigInt(t.capacity)<BigInt(d))throw new Error("Withdrawal required ".concat(BigInt(d)," shannons at least, provided ").concat(BigInt(t.capacity),"."));const p=await this.provider.godwokenClient.getNonce(o);console.log("nonce:",p);const u="0x"+"00".repeat(32),b={nonce:"0x"+BigInt(p).toString(16),capacity:"0x"+BigInt(t.capacity).toString(16),amount:"0x"+BigInt(t.amount).toString(16),sudt_script_hash:t.sudt_script_hash,account_script_hash:c,sell_amount:"0x0",sell_capacity:"0x0",owner_lock_hash:i,payment_lock_hash:u,fee:{sudt_id:"0x1",amount:"0x0"}};console.log("rawWithdrawalRequest:",b);const g=this.generateWithdrawalMessageToSign(b,n);console.log("message:",g);const f=await this.signMessageMetamaskPersonalSign(g);console.log("signatureMetamaskPersonalSign:",f);const x={raw:b,signature:f};let y;console.log("withdrawalRequest:",x);try{y=await this.provider.godwokenClient.submitWithdrawalRequest(x)}catch(v){return void e.emit("error",v)}e.emit("sent",y),console.log("withdrawal request result:",y);let m=0;const _=setInterval((async()=>{m++;const t=await this.getWithdrawal(y);t&&"pending"===t.status&&(console.log("withdrawal pending:",t),e.emit("pending",y)),t&&"committed"===t.status&&(console.log("withdrawal committed:",t),e.emit("success",y),clearInterval(_)),null===t&&m>100&&(e.emit("fail",y),clearInterval(_))}),1e4)}async getWithdrawal(e){const t=await this.provider.godwokenClient.getWithdrawal(e);return console.log("getWithdrawal result:",t),t}async signMessageMetamaskPersonalSign(e){let t=await this.provider.ethereum.request({method:"personal_sign",params:[this.provider.l2Address,e]}),n=Number.parseInt(t.slice(-2),16);return n>=27&&(n-=27),t="0x"+t.slice(2,-2)+n.toString(16).padStart(2,"0"),t}async signMessageMetamaskEthSign(e){let t=await this.provider.ethereum.request({method:"eth_sign",params:[this.provider.l2Address,e]}),n=Number.parseInt(t.slice(-2),16);return n>=27&&(n-=27),t="0x"+t.slice(2,-2)+n.toString(16).padStart(2,"0"),t}signMessage(e,t){const n=g.ecdsaSign(new Uint8Array(new h.toolkit.Reader(e).toArrayBuffer()),new Uint8Array(new h.toolkit.Reader(t).toArrayBuffer())),a=new ArrayBuffer(65),s=new Uint8Array(a);s.set(n.signature,0);let i=n.recid;i>=27&&(i-=27),s.set([i],64);return new h.toolkit.Reader(a).serializeJson()}generateWithdrawalMessageToSign(e,t){const n=new h.toolkit.Reader(M(S(e))).serializeJson(),a=new h.toolkit.Reader(t+n.slice(2)).toArrayBuffer();return h.utils.ckbHash(a).serializeJson()}minimalWithdrawalCapacity(e){const t="0x"+"00".repeat(32),n="0x0",a=t,s={account_script_hash:t,withdrawal_block_hash:t,withdrawal_block_number:n,sudt_script_hash:t,sell_amount:n,sell_capacity:n,owner_lock_hash:t,payment_lock_hash:t},i=new h.toolkit.Reader(function(e){const t=new Uint8Array(0+V.size()+V.size()+H.size()+V.size()+J.size()+H.size()+V.size()+V.size());return new DataView(t.buffer),t.set(new Uint8Array(Y(e.account_script_hash)),0),t.set(new Uint8Array(Y(e.withdrawal_block_hash)),0+V.size()),t.set(new Uint8Array(Q(e.withdrawal_block_number)),0+V.size()+V.size()),t.set(new Uint8Array(Y(e.sudt_script_hash)),0+V.size()+V.size()+H.size()),t.set(new Uint8Array(K(e.sell_amount)),0+V.size()+V.size()+H.size()+V.size()),t.set(new Uint8Array(Q(e.sell_capacity)),0+V.size()+V.size()+H.size()+V.size()+J.size()),t.set(new Uint8Array(Y(e.owner_lock_hash)),0+V.size()+V.size()+H.size()+V.size()+J.size()+H.size()),t.set(new Uint8Array(Y(e.payment_lock_hash)),0+V.size()+V.size()+H.size()+V.size()+J.size()+H.size()+V.size()),t.buffer}(function(e){let{debugPath:t="withdrawal_lock_args"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{account_script_hash:O(32),withdrawal_block_hash:O(32),withdrawal_block_number:k(8),sudt_script_hash:O(32),sell_amount:k(16),sell_capacity:k(8),owner_lock_hash:O(32),payment_lock_hash:O(32)})}(s))).serializeJson(),r={code_hash:t,hash_type:"data",args:a+i.slice(2)};let c,o="0x";e&&(c={code_hash:t,hash_type:"data",args:t},o="0x"+"00".repeat(16));const l={cell_output:{lock:r,type:c,capacity:n},data:o};return"0x"+h.helpers.minimalCellCapacity(l).toString(16)}async getL2CkbBalance(e){const t=await this.provider.web3.eth.getBalance((null===e||void 0===e?void 0:e.l2Address)||this.provider.l2Address);return"0x"+Number(t).toString(16)}getBuiltinErc20List(){const e=[];return v.forEach((t=>{const n={code_hash:t.l1Lock.code_hash,args:t.l1Lock.args,hash_type:t.l1Lock.hash_type},a=h.utils.computeScriptHash(n);e.push({name:t.name,symbol:t.symbol,decimals:t.decimals,address:t.address,tokenURI:t.tokenURI,sudt_script_hash:a})})),e}async getErc20Balances(e){const t={balances:[]};let n=[];for(let a=0;a<e.addresses.length;a++){const t=e.addresses[a],s=new this.provider.web3.eth.Contract(de.abiItems,t).methods.balanceOf(this.provider.l2Address).call();n.push(s)}return await Promise.all(n).then((e=>{e.forEach((e=>{t.balances.push("0x"+Number(e).toString(16))}))})),t}async injectCapacity(e,t,n){const a=n+BigInt(1e5);let s=BigInt(0);const i=[],r=this.provider.ckbIndexer.collector({lock:t,type:"empty"});for await(const o of r.collect())if((!o.data||"0x"===o.data||"0x0"===o.data||"0x00"===o.data)&&(s+=BigInt(o.cell_output.capacity),i.push(o),s>=a))break;if(s<a)throw new Error("Not enough CKB, expected: ".concat(a,", actual: ").concat(s," "));const c={cell_output:{capacity:"0x"+BigInt(s-a).toString(16),lock:t},data:"0x"};return e=(e=e.update("inputs",(e=>e.push(...i)))).update("outputs",(e=>e.push(c)))}}var be=n(2);const ge=Object(a.createContext)(null),fe=e=>{const[t,n]=Object(a.useState)();return Object(a.useEffect)((()=>{d()().then((e=>{e.request({method:"eth_accounts"}).then((t=>{if(!t||!t[0])return;const a=new ue(new pe(t[0],e));n(a)})),e.on("accountsChanged",(t=>{if(!t||!t[0])return n(void 0);const a=new ue(new pe(e.selectedAddress,e));n(a)}))}))}),[]),Object(be.jsx)(ge.Provider,{value:t||null,children:e.children})};var xe=n(28),we=n(839),ye=n(840),me=n(841),je=n(834),_e=n(835),ve=n(404),Ae=n(78),ke=n(29);const Oe=()=>Object(a.useContext)(ge),ze=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=e.toString();if(0===t)return n;const a=n.slice(0,-t)||"0",s="0"===a?1e8:1e4;let i=n.slice(-t).padStart(t,"0").slice(0,"0"===a?9:5);return i=(Math.round(Number("0.".concat(i))*s)/s).toFixed("0"===a?8:4).replace(/(\d)0+$/,"$1").slice(2),"".concat(a).concat("0"===i?"":".".concat(i))},Be=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{maxDecimalPlace:a=4}=n,s=e.toString();if(0===t)return s;const i=s.slice(0,-t)||"0",r=s.slice(-t).padStart(t,"0").replace(/(\d)0+$/,"$1").slice(0,a);return"".concat(i).concat("0"===r?"":".".concat(r))};var Ce;const Se=ke.a.input(Ce||(Ce=Object(xe.a)(["\n  width: 0;\n  position: relative;\n  font-weight: 500;\n  outline: none;\n  border: none;\n  flex: 1 1 auto;\n  background-color: transparent;\n  font-size: 16px;\n  text-align: ",";\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding: 0px;\n  -webkit-appearance: textfield;\n\n  ::-webkit-search-decoration {\n    -webkit-appearance: none;\n  }\n\n  [type='number'] {\n    -moz-appearance: textfield;\n  }\n\n  ::-webkit-outer-spin-button,\n  ::-webkit-inner-spin-button {\n    -webkit-appearance: none;\n  }\n\n  :disabled {\n    cursor: text;\n  }\n"])),(e=>{let{align:t}=e;return t&&t}));const Ue=RegExp("^\\d*(?:\\\\[.])?\\d*$");var Ie,Re,Ee=s.a.memo((function(e){let{value:t,onUserInput:n,placeholder:a,...s}=e;return Object(be.jsx)(Se,{...s,value:t,onChange:e=>{var t;(""===(t=e.target.value.replace(/,/g,"."))||Ue.test(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")))&&n(t)},inputMode:"decimal",title:"Token Amount",autoComplete:"off",autoCorrect:"off",type:"text",pattern:"^[0-9]*[.,]?[0-9]*$",placeholder:a||"0.0",minLength:1,maxLength:79,spellCheck:"false"})}));const Ne=ke.a.div(Ie||(Ie=Object(xe.a)(["\n  font-size: 14px;\n  border-radius: 16px;\n  background-color: rgb(60, 58, 75);\n  box-shadow: rgb(74 74 104 / 10%) 0px 2px 2px -1px;\n  .first-row {\n    margin-bottom: 3px;\n    padding: 0.75rem 1rem 0px;\n  }\n  .anticon {\n    font-size: 12px;\n  }\n\n  .input-wrapper {\n    padding: 0.75rem 0.5rem 0.75rem 1rem;\n  }\n"]))),Le=ke.a.div(Re||(Re=Object(xe.a)(["\n  display: flex;\n  justify-content: space-between;\n  .ant-typography {\n    color: white;\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n  .ckb-logo {\n    height: 24px;\n    width: 24px;\n    margin-right: 8px;\n  }\n  .max-button {\n    height: 32px;\n    padding: 0px 16px;\n    background-color: transparent;\n    color: rgb(255, 67, 66);\n    font-weight: 600;\n    &:hover {\n      cursor: pointer;\n    }\n  }\n"])));function Te(e){let{value:t,onUserInput:n,label:s}=e;const[i,r]=Object(a.useState)(!0),[c,o]=Object(a.useState)(""),l=Oe();Object(a.useEffect)((()=>{(async()=>{const e=await(null===l||void 0===l?void 0:l.getL2CkbBalance())||"";o(e)})()}),[l]),Object(a.useEffect)((()=>{t!==ze(BigInt(c),8)?r(!0):r(!1)}),[t,c]);return Object(be.jsxs)(Ne,{children:[Object(be.jsxs)(Le,{className:"first-row",children:[Object(be.jsx)(je.a.Text,{children:s}),Object(be.jsxs)(je.a.Text,{children:["Balance: ",ze(BigInt(c),8)||""]})]}),Object(be.jsxs)(Le,{className:"input-wrapper",children:[Object(be.jsx)(Ee,{className:"token-amount-input",value:t,placeholder:"Minimum 400 CKB",onUserInput:e=>{n(e)}}),i&&Object(be.jsx)(je.a.Text,{className:"max-button",onClick:()=>{n(ze(BigInt(c),8)),r(!1)},children:"MAX"}),Object(be.jsx)("img",{className:"ckb-logo",src:"/static/ckb.svg",alt:""}),Object(be.jsx)(je.a.Text,{children:"CKB"})]})]})}var Me=n(833),De=n(838),We=n(406),Pe=n(837);const Ge=3600,qe=86400,Fe=2629800,He=31557600;var Qe,Je,Ke=e=>{let t=Math.abs(e);const n={years:0,months:0,days:0,hours:0,minutes:0,seconds:0};return t>=He&&(n.years=Math.floor(t/He),t-=n.years*He),t>=Fe&&(n.months=Math.floor(t/Fe),t-=n.months*Fe),t>=qe&&(n.days=Math.floor(t/qe),t-=n.days*qe),t>=Ge&&(n.hours=Math.floor(t/Ge),t-=n.hours*Ge),t>=60&&(n.minutes=Math.floor(t/60),t-=60*n.minutes),n.seconds=Math.floor(t),n};const{Text:Ve}=je.a,Ye=ke.a.div(Qe||(Qe=Object(xe.a)(["\n  background: rgb(39, 37, 52);\n  padding: 16px;\n  border-radius: 12px;\n  .header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      font-weight: 400;\n    line-height: 1.5;\n    font-size: 14px;\n  }\n  .icons {\n    display: flex;\n    img {\n      width: 20px;\n      height: 20px;\n      margin-right: 5px;\n    }\n  }\n  .ckb-icon {\n      width: 20px;\n      height: 20px;\n      background: url(./static/ckb.svg) no-repeat no-repeat;\n      background-size: contain;\n  }\n  .number {\n    margin-top: 3px;\n  }\n  .time {\n    align-self: center;\n    display: flex;\n    height: 40px;\n    align-items: center;\n    .ant-typography {\n        padding-right: 5px;\n    }\n  }\n  .ant-typography {\n    color: white;\n  }\n  .list-detail {\n    padding-top: 10px;\n  }\n  .withdraw-button {\n    align-items: center;\n    border: 0px;\n    border-radius: 16px;\n    box-shadow: rgb(14 14 44 / 40%) 0px -1px 0px 0px inset;\n    cursor: pointer;\n    display: inline-flex;\n    font-family: inherit;\n    font-size: 16px;\n    font-weight: 600;\n    -webkit-box-pack: center;\n    justify-content: center;\n    letter-spacing: 0.03em;\n    line-height: 1;\n    opacity: 1;\n    outline: 0px;\n    transition: background-color 0.2s ease 0s, opacity 0.2s ease 0s;\n    height: 32px;\n    padding: 0px 16px;\n    background-color: rgb(255, 67, 66);\n    color: white;\n    margin-left: 4px;\n    margin-top: 8px;\n  }\n"]))),Xe=ke.a.div(Je||(Je=Object(xe.a)(["\n  height: 24px;\n  display: flex;\n  justify-content: space-between;\n  .ant-typography {\n    color: white;\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n"])));var Ze,$e,et,tt,nt=e=>{let{remainingBlockNumber:t,capacity:n,amount:s,erc20:i,now:r=0,cell:c}=e;const[o,l]=Object(a.useState)(!1),[d,h]=Object(a.useState)(0),p=Oe(),u=Object(a.useCallback)((()=>{l((e=>!e))}),[]);Object(a.useEffect)((()=>{(async()=>{const e=await(null===p||void 0===p?void 0:p.getBlockProduceTime())||0;h(e)})()}),[p]);const b=Object(a.useMemo)((()=>Date.now()+t*d),[d,t]),g=Object(a.useMemo)((()=>Math.max(0,b-r)),[r,b]),f=Object(a.useMemo)((()=>0===t),[t]),{days:x,hours:w,minutes:y,seconds:m}=Object(a.useMemo)((()=>Ke(g/1e3)),[g]),[j,_]=Object(a.useMemo)((()=>{if("0"===n)return console.error("[warn] a withdrawal request cell with zero capacity"),["",""];const e=BigInt(n);return["".concat(ze(e,8)," CKB"),"".concat(Be(e,8)," CKB")]}),[n]),[v,A]=Object(a.useMemo)((()=>{if(""===s||!i)return["",""];const e=BigInt(s);return["".concat(ze(e,i.decimals)," ").concat(i.symbol),"".concat(Be(e,i.decimals)," ").concat(i.symbol)]}),[s,i]);return Object(be.jsxs)(Ye,{onClick:f?void 0:u,children:[Object(be.jsxs)("div",{className:"header",children:[Object(be.jsxs)("div",{className:"amount",children:[Object(be.jsxs)("div",{className:"icons",children:[null!==i&&void 0!==i&&i.tokenURI?Object(be.jsx)("img",{src:null===i||void 0===i?void 0:i.tokenURI,alt:""}):"",Object(be.jsx)("div",{className:"ckb-icon"})]}),Object(be.jsxs)("div",{className:"number",children:[v,""===v?"":" and ",j]})]}),f?Object(be.jsx)(Pe.a,{placement:"top",title:"Confirm unlock withdrawal",onConfirm:async()=>{const e=await(null===p||void 0===p?void 0:p.unlock({cell:c}));ve.a.success({message:"Unlock Tx(".concat(e,") is successful"),onClick:()=>{window.open("https://explorer.nervos.org/aggron/transaction/".concat(e),"_blank")}})},okText:"Confirm",cancelText:"Cancel",children:Object(be.jsx)(Ae.a,{className:"withdraw-button",children:"withdraw"})}):o?Object(be.jsx)("div",{className:"time",children:Object(be.jsx)(De.a,{})}):Object(be.jsxs)("div",{className:"time",children:[Object(be.jsx)(Ve,{title:"Estimated time left",children:x>0?"".concat(x).concat(x>1?" days":" day"):"".concat(w>0?"".concat(w.toString().padStart(2,"0"),":"):"").concat(y.toString().padStart(2,"0"),":").concat(m.toString().padStart(2,"0"))}),Object(be.jsx)(We.a,{})]})]}),o&&Object(be.jsxs)("div",{className:"list-detail",children:[Object(be.jsxs)(Xe,{children:[Object(be.jsx)(Ve,{children:"Blocks remaining:"}),Object(be.jsx)(Ve,{children:t})]}),Object(be.jsxs)(Xe,{children:[Object(be.jsx)(Ve,{children:"Estimated time left:"}),Object(be.jsx)(Ve,{children:"".concat(x>0?"".concat(x).concat(x>1?" days ":" day "):"").concat(w.toString().padStart(2,"0"),":").concat(y.toString().padStart(2,"0"),":").concat(m.toString().padStart(2,"0"))})]})]})]})};const{Text:at}=je.a,st=ke.a.div(Ze||(Ze=Object(xe.a)(["\n    border-radius: 16px;\n    background-color: rgb(60, 58, 75);\n    box-shadow: rgb(74 74 104 / 10%) 0px 2px 2px -1px;\n    .first-row {\n      margin-bottom: 3px;\n    }\n    .anticon {\n      font-size: 12px;\n    }\n    .max-button {\n      height: 32px;\n      line-height: 32px;\n      padding: 0px 16px;\n      background-color: transparent;\n      color: rgb(255, 67, 66);\n      font-weight: 600;\n    }\n    .token-list {\n      height: 390px;\n      overflow-y: auto;\n    }\n    .first-row {\n      margin-bottom: 3px;\n      padding: 0.75rem 1rem 0px;\n    }\n    .input-wrapper {\n      height: 56px;\n      padding: 0.75rem 0.5rem 0.75rem 1rem;\n      display: flex;\n      align-items: center;\n    }\n    .currency-wrapper {\n      display: flex;\n      align-items: center;\n    }\n    .anticon {\n      margin-left: 10px;\n    }\n"]))),it=ke.a.div($e||($e=Object(xe.a)(["\n   height: 390px;\n    overflow-y: auto;\n"]))),rt=Object(ke.a)(_e.a)(et||(et=Object(xe.a)(["\n  color: white;\n  .ant-modal-content {\n    border-radius: 32px;\n    background: rgb(39, 37, 52);\n    box-shadow: rgb(14 14 44 / 10%) 0px 20px 36px -8px, rgb(0 0 0 / 5%) 0px 1px 1px;\n    border: 1px solid rgb(60, 58, 75);\n    color: white;\n  }\n  .ant-modal-header {\n    background: rgb(39, 37, 52);\n    border: 1px solid rgb(60, 58, 75);\n    border-top-left-radius: 32px;\n    border-top-right-radius: 32px;\n    padding: 12px 24px;\n    height: 73px;\n    display: flex;\n    align-items: center;\n  }\n  .ant-modal-title, .ant-list-item {\n    color: white;\n  }\n  .ant-modal-body {\n    padding: 0px;\n  }\n  .ant-modal-close-x {\n    color: white;\n  }\n  .ant-list-item {\n    border-bottom: none;\n    padding: 4px 20px;\n    height: 56px;\n    &:hover {\n      background-color: rgb(60, 58, 75);\n      cursor: pointer;\n    }\n    &.selected {\n      background-color: rgb(60, 58, 75);\n    }\n  }\n  .currency-item {\n    width: 100%;\n    .info {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n    .icon {\n      width: 24px;\n      height: 24px;\n      margin-right: 10px;\n    }\n    .symbol-name {\n      display: flex;\n      flex-direction: column;\n      .symbol {\n        font-size: 16px;\n        font-weight: 600;\n        line-height: 1.5;\n      }\n      .name {\n        font-size: 14px;\n        line-height: 1.5;\n      }\n    }\n  }\n"]))),ct=ke.a.div(tt||(tt=Object(xe.a)(["\n  display: flex;\n  justify-content: space-between;\n  .ant-typography {\n    color: white;\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n  .ckb-logo {\n    height:24px;\n    width: 24px;\n    margin-right: 8px;\n  }\n  .max-button {\n      height: 32px;\n      padding: 0px 16px;\n      background-color: transparent;\n      color: rgb(255, 67, 66);\n      font-weight: 600;\n    }\n"])));function ot(e){let{autoFocus:t,disableInput:n,value:s,onUserInput:i,label:r,onSelectedChange:c}=e;const[o,l]=Object(a.useState)(""),[d,h]=Object(a.useState)(!1),[p,u]=Object(a.useState)([]),[b,g]=Object(a.useState)([]),[f,x]=Object(a.useState)(),[w,y]=Object(a.useState)(),m=Oe(),[j,_]=Object(a.useState)(!1);Object(a.useEffect)((()=>{(async()=>{if(m){const e=m.getBuiltinErc20List();u(e);const t=e.map((e=>e.address)),n=await m.getErc20Balances({addresses:t});g(n.balances)}})()}),[m]),Object(a.useEffect)((()=>{h(!(!f||s===o&&""!==s))}),[s,o,f]),Object(a.useEffect)((()=>{if(b&&b.length&&void 0!==w&&f){const e=b[w],t=Be(BigInt(e),f.decimals);l(t)}}),[w,b,f]);return Object(be.jsxs)(st,{children:[Object(be.jsxs)(ct,{className:"first-row",children:[Object(be.jsx)(je.a.Text,{children:r}),Object(be.jsx)(je.a.Text,{children:o||""})]}),Object(be.jsxs)(ct,{className:"input-wrapper",children:[Object(be.jsx)(Ee,{autoFocus:t,disabled:n,className:"token-amount-input",value:s,onUserInput:e=>{i(e)}}),d&&Object(be.jsx)("div",{className:"max-button",onClick:()=>{i(o),h(!1)},children:"MAX"}),Object(be.jsxs)("div",{className:"currency-wrapper",onClick:()=>{_(!0)},children:[f?Object(be.jsxs)("div",{className:"currency-icon",children:[Object(be.jsx)("img",{className:"ckb-logo",src:f.tokenURI,alt:""}),Object(be.jsx)(je.a.Text,{children:f.symbol})]}):Object(be.jsx)(at,{children:"Select a currency "}),Object(be.jsx)(We.a,{})]})]}),Object(be.jsx)(rt,{title:"Select a Token",visible:j,onOk:()=>{_(!1)},onCancel:()=>{_(!1)},footer:null,children:Object(be.jsx)(it,{className:"token-list",children:Object(be.jsx)(Me.b,{dataSource:p,renderItem:(e,t)=>Object(be.jsx)(Me.b.Item,{className:e.address===(null===f||void 0===f?void 0:f.address)?"selected":"",onClick:()=>((e,t)=>{x(t),c(t),_(!1),h(!0),i(""),y(e)})(t,e),children:Object(be.jsxs)(Xe,{className:"currency-item",children:[Object(be.jsxs)("div",{className:"info",children:[Object(be.jsx)("img",{className:"icon",src:e.tokenURI,alt:""}),Object(be.jsxs)("div",{className:"symbol-name",children:[Object(be.jsx)(at,{className:"symbol",children:e.symbol}),Object(be.jsx)(at,{className:"name",children:e.name})]})]}),Object(be.jsx)("div",{children:b.length?Be(BigInt(b[t]),e.decimals):""})]})})})})})]})}var lt,dt=n(405),ht=n(131),pt=n(836);const ut=ke.a.div(lt||(lt=Object(xe.a)(["\n  color: #fff;\n  .text-pair {\n    display: flex;\n    justify-content: space-between;\n  }\n"])));function bt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return e.substring(0,t)+"..."+e.substring(e.length-n)}const gt=()=>{const e=Oe(),t=Object(a.useMemo)((()=>{if(e)return e.provider.getL2Address()}),[e]);return e&&t?Object(be.jsx)(ht.a,{title:Object(be.jsxs)(ut,{children:[Object(be.jsxs)("div",{className:"address-content",children:[Object(be.jsx)("label",{htmlFor:"",children:"ETH ADDRESS"}),Object(be.jsxs)(pt.a.Group,{compact:!0,children:[Object(be.jsx)(pt.a,{style:{width:"calc(100% - 33px)"},value:e.provider.getL2Address()}),Object(be.jsx)(ht.a,{title:"copy git url",children:Object(be.jsx)(Ae.a,{icon:Object(be.jsx)(dt.a,{})})})]})]}),Object(be.jsxs)("div",{className:"address-content",children:[Object(be.jsx)("label",{htmlFor:"",children:"L1 WALLET ADDRESS"}),Object(be.jsxs)(pt.a.Group,{compact:!0,children:[Object(be.jsx)(pt.a,{style:{width:"calc(100% - 33px)"},value:e.provider.getL1Address()}),Object(be.jsx)(ht.a,{title:"copy git url",children:Object(be.jsx)(Ae.a,{icon:Object(be.jsx)(dt.a,{})})})]})]})]}),children:bt(t)}):null};var ft;const xt=Object(ke.a)(Ae.a)(ft||(ft=Object(xe.a)(["\n  &.ant-btn-primary {\n    background: rgb(60,58,75);\n    border: none;\n  }\n"]))),wt=()=>{const e=Oe();return Object(be.jsx)(xt,{type:"primary",onClick:function(){e||d()().then((e=>{e.request({method:"eth_requestAccounts"})}))},children:e?Object(be.jsx)(gt,{}):"Connect"})};var yt;const mt=ke.a.div(yt||(yt=Object(xe.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  padding: 16px;\n  background: radial-gradient(89.56% 89.56% at 50.04% 10.44%, rgb(60, 58, 75) 0%, rgb(28, 27, 37) 92.56%);\n  margin-bottom: 20px;\n  color: white;\n  .address:hover {\n    cursor: pointer;\n  }\n"])));var jt,_t=()=>Object(be.jsxs)(mt,{children:[Object(be.jsx)("div",{className:"icon"}),Object(be.jsx)("div",{className:"title",children:"Withdrawal"}),Object(be.jsx)("div",{className:"address",children:Object(be.jsx)(wt,{})})]});const vt=ke.a.div(jt||(jt=Object(xe.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n  min-height: calc(100vh);\n  background: radial-gradient(89.56% 89.56% at 50.04% 10.44%, rgb(60, 58, 75) 0%, rgb(28, 27, 37) 92.56%);\n"])));var At,kt,Ot,zt,Bt,Ct=e=>{let{children:t,...n}=e;return Object(be.jsxs)(vt,{...n,children:[Object(be.jsx)(_t,{}),t]})};const{Text:St}=je.a,Ut=ke.a.div(At||(At=Object(xe.a)(["\n  width: 436px;\n  background: rgb(39, 37, 52);\n  border-radius: 24px;\n  color: white;\n"]))),It=ke.a.div(kt||(kt=Object(xe.a)(["\n  display: flex;\n  justify-content: space-between;\n  padding: 24px;\n  align-items: center;\n  a,\n  .ant-typography {\n    color: white;\n  }\n"]))),Rt=ke.a.div(Ot||(Ot=Object(xe.a)(["\n  padding: 24px;\n  grid-auto-rows: auto;\n  row-gap: 8px;\n  .icon {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    padding-top: 8px;\n    padding-bottom: 8px;\n  }\n"]))),Et=ke.a.div(zt||(zt=Object(xe.a)(["\n  margin-top: 20px;\n  display: flex;\n  justify-content: center;\n  .submit-button {\n    align-items: center;\n    border: 0px;\n    border-radius: 16px;\n    box-shadow: rgb(14 14 44 / 40%) 0px -1px 0px 0px inset;\n    cursor: pointer;\n    display: inline-flex;\n    font-family: inherit;\n    font-size: 16px;\n    font-weight: 600;\n    -webkit-box-pack: center;\n    justify-content: center;\n    letter-spacing: 0.03em;\n    line-height: 1;\n    opacity: 1;\n    outline: 0px;\n    transition: background-color 0.2s ease 0s, opacity 0.2s ease 0s;\n    height: 48px;\n    padding: 0px 24px;\n    background-color: rgb(255, 67, 66);\n    color: white;\n    width: 100%;\n    &:disabled {\n      background-color: rgb(60, 55, 66);\n      border-color: rgb(60, 55, 66);\n      box-shadow: none;\n      color: rgb(104, 102, 123);\n      cursor: not-allowed;\n    }\n  }\n  button:hover {\n    cursor: pointer;\n  }\n"]))),Nt=Object(ke.a)(_e.a)(Bt||(Bt=Object(xe.a)(["\n  color: white;\n  .ant-modal-content {\n    border-radius: 32px;\n    background: rgb(39, 37, 52);\n    box-shadow: rgb(14 14 44 / 10%) 0px 20px 36px -8px, rgb(0 0 0 / 5%) 0px 1px 1px;\n    border: 1px solid rgb(60, 58, 75);\n    color: white;\n  }\n  .ant-modal-header {\n    background: rgb(39, 37, 52);\n    border: 1px solid rgb(60, 58, 75);\n    border-top-left-radius: 32px;\n    border-top-right-radius: 32px;\n    padding: 12px 24px;\n    height: 73px;\n    display: flex;\n    align-items: center;\n  }\n  .ant-modal-title,\n  .ant-list-item {\n    color: white;\n  }\n  .ant-modal-body {\n    padding: 24px;\n  }\n  .ant-modal-close-x {\n    color: white;\n  }\n  .ant-typography {\n    color: white;\n    justify-content: space-between;\n  }\n  .text-pair {\n    padding-top: 5px;\n    display: flex;\n    justify-content: space-between;\n    font-size: 24px;\n  }\n  .tips {\n    margin: 24px 0;\n  }\n"])));function Lt(){const[e,t]=Object(a.useState)(""),[n,s]=Object(a.useState)(""),[i,r]=Object(a.useState)(!1),[o,l]=Object(a.useState)(!1),[d,h]=Object(a.useState)(!0),[p,u]=Object(a.useState)(),b=Oe();Object(a.useEffect)((()=>{Number(e)>=400?h(!1):h(!0)}),[e]);return Object(be.jsxs)(Ct,{children:[Object(be.jsxs)(Ut,{children:[Object(be.jsxs)(It,{className:"header",children:[Object(be.jsx)(c.b,{to:"/",children:Object(be.jsx)(we.a,{})}),Object(be.jsx)(St,{children:"Request Withdrawal"}),Object(be.jsx)(ye.a,{})]}),Object(be.jsxs)(Rt,{className:"main",children:[Object(be.jsx)(Te,{value:e,onUserInput:t,label:"Withdraw"}),Object(be.jsx)("div",{className:"icon",children:Object(be.jsx)(me.a,{})}),Object(be.jsx)(ot,{value:n,onUserInput:s,label:"sUDT(optional)",onSelectedChange:u}),Object(be.jsx)(Et,{children:Object(be.jsx)(Ae.a,{className:"submit-button",disabled:d,onClick:()=>{r(!0)},children:"Request Withdrawal"})})]}),Object(be.jsx)("div",{className:"footer"})]}),Object(be.jsxs)(Nt,{title:"Confirm Request",visible:i,onCancel:()=>{r(!1)},footer:null,children:[Object(be.jsxs)("div",{className:"text-pair",children:[Object(be.jsx)(St,{children:"Block wait"}),Object(be.jsx)(St,{children:"10000"})]}),Object(be.jsxs)("div",{className:"text-pair",children:[Object(be.jsx)(St,{children:"Estimated time"}),Object(be.jsx)(St,{children:"5 days"})]}),Object(be.jsx)("div",{className:"tips",children:"Layer 2 assets will be locked in Withdrawal Request, available to withdraw to Layer 1 after maturity. Request Withdrawal"}),Object(be.jsx)(Et,{children:Object(be.jsx)(Ae.a,{className:"submit-button",loading:o,onClick:()=>{l(!0);const t=BigInt(e)*BigInt(Math.pow(10,8));let a,s="0x0",i="0x0000000000000000000000000000000000000000000000000000000000000000";if(p&&(s="0x"+BigInt(Number(n)*Math.pow(10,p.decimals)).toString(16),i=p.sudt_script_hash),b){try{a=b.withdrawWithEvent({capacity:"0x"+t.toString(16),amount:s,sudt_script_hash:i})}catch(a){return void console.log("withdrawal error:",a)}a.on("sent",(e=>{r(!1),ve.a.info({message:"Withdrawal Tx(".concat(e,") has sent")}),l(!1)})),a.on("pending",(e=>{console.log("pending triggerd",e)})),a.on("success",(e=>{r(!1),ve.a.success({message:"Withdrawal Tx(".concat(e,") is successful")})})),a.on("error",(e=>{l(!1),ve.a.error({message:e instanceof Error?e.message:JSON.stringify(e)})}))}},children:"Request Withdrawal"})})]})]})}var Tt,Mt;const Dt=ke.a.div(Tt||(Tt=Object(xe.a)(["\n  width: 436px;\n  background: rgb(39, 37, 52);\n  border-radius: 24px;\n  color: white;\n  .request-withdrawal {\n    padding: 24px;\n  }\n  .title {\n    font-size: 20px;\n    font-weight: 600;\n    line-height: 1.1;\n    margin-bottom: 8px;\n  }\n  .description {\n    font-weight: 400;\n    line-height: 1.5;\n    font-size: 14px;\n  }\n  .button-container {\n    margin-top: 16px\n  }\n  .request-button {\n    -webkit-box-align: center;\n    align-items: center;\n    border: 0px;\n    border-radius: 16px;\n    box-shadow: rgb(14 14 44 / 40%) 0px -1px 0px 0px inset;\n    cursor: pointer;\n    display: inline-flex;\n    font-family: inherit;\n    font-size: 16px;\n    font-weight: 600;\n    -webkit-box-pack: center;\n    justify-content: center;\n    letter-spacing: 0.03em;\n    line-height: 1;\n    opacity: 1;\n    outline: 0px;\n    transition: background-color 0.2s ease 0s, opacity 0.2s ease 0s;\n    height: 48px;\n    padding: 0px 24px;\n    background-color: rgb(255, 67, 66);\n    color: white;\n  }\n"]))),Wt=ke.a.div(Mt||(Mt=Object(xe.a)(["\n  >.header {\n    -webkit-box-align: center;\n    align-items: center;\n    -webkit-box-pack: justify;\n    justify-content: space-between;\n    padding: 24px;\n    width: 100%;\n    border-bottom: 1px solid rgb(60, 58, 75);\n    border-top: 1px solid rgb(60, 58, 75);\n    font-size: 16px;\n    font-weight: 600;\n    line-height: 1.5;\n  }\n  .list {\n    max-height: calc(100vh - 400px);\n    overflow-y: auto;\n    background-color: rgb(16, 12, 24);\n    padding: 24px;\n    border-bottom-left-radius: 24px;\n    border-bottom-right-radius: 24px;\n    &>div {\n      margin-bottom: 16px;\n    }\n  }\n"])));var Pt=()=>{const[e,t]=Object(a.useState)([]),n=Oe(),s=function(){const[e,t]=Object(a.useState)((()=>Date.now()));return Object(a.useEffect)((()=>{const e=()=>{t(Date.now()),setTimeout(e,1e3)};setTimeout(e,1e3)}),[]),e}();return Object(a.useEffect)((()=>{(async()=>{if(n){const e=await(null===n||void 0===n?void 0:n.listWithdraw());t(e)}})()}),[n]),Object(be.jsx)(Ct,{children:Object(be.jsxs)(Dt,{className:"content",children:[Object(be.jsxs)("div",{className:"request-withdrawal",children:[Object(be.jsx)("div",{className:"title",children:"Withdrawal"}),Object(be.jsx)("div",{className:"description",children:"To withdraw assets back to Layer 1, you need to have CKB balance in your L1 Wallet Address"}),Object(be.jsx)("div",{className:"button-container",children:Object(be.jsx)(c.b,{to:"/request-withdrawal",className:"request-button",children:"Request Withdrawal"})})]}),Object(be.jsxs)(Wt,{className:"withdrawal-request",children:[Object(be.jsx)("div",{className:"header",children:"Your Withdrawal Requests"}),Object(be.jsx)("div",{className:"list",children:e.map(((e,t)=>Object(a.createElement)(nt,{now:s,...e,key:t})))})]})]})})};var Gt=function(){return Object(be.jsx)(fe,{children:Object(be.jsx)(c.a,{children:Object(be.jsxs)(o.c,{children:[Object(be.jsx)(o.a,{path:"/",element:Object(be.jsx)(Pt,{})}),Object(be.jsx)(o.a,{path:"/request-withdrawal",element:Object(be.jsx)(Lt,{})})]})})})};var qt=e=>{e&&e instanceof Function&&import("web-vitals").then((t=>{let{getCLS:n,getFID:a,getFCP:s,getLCP:i,getTTFB:r}=t;n(e),a(e),s(e),i(e),r(e)}))},Ft=(n(825),n(257));Object(Ft.initializeConfig)(Ft.predefined.AGGRON4),r.a.render(Object(be.jsx)(s.a.StrictMode,{children:Object(be.jsx)(Gt,{})}),document.getElementById("root")),qt()}},[[829,1,2]]]);
//# sourceMappingURL=main.131676e0.chunk.js.map